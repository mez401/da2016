---
title: "Лабораторная работа 4"
author: "Мезенцева Алена"
date: '18 декабря 2016 г '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Исходные данные

Гамма-распределения это семейство распределений вероятности, определяемых следующей функцией плотности вероятности:

f(x) = (x^(a-1)⋅e^(-x/s))/(s^a)⋅Γ(a), 
где гамма-функция Γ(a) выбирается таким образом, что общая вероятность всех неотрицательных x равняется 1. Параметр a называется форма, параметр s масштаб. В R существует стандартная функция для получения плотности вероятности: dgamma().

В лабораторной работе следует удостовериться, что математическое ожидание этого распределения равняется a⋅s, а дисперсия a⋅s^2.

Если мат. ожидание (μ) и дисперсия (σ²) известны, тогда параметры будут равны:
a = μ²/σ²,
s = σ²/μ

Необходимо выполнить подгонку гамма-распределения под данные и оценить результаты подгонки. Данными для анализа будет встроенный в R набор данных о весе тел и сердец котов и кошек.

## Задание

1. Загрузите датафрейм cats (посмотреть описание датафрейма можно при помощи команды help(cats)) из пакета MASS, при помощи команд: library(MASS) data(cats).

```{r}
library(MASS)
data(cats)
```

2. Выполните команду summary(cats) и опишите результат.

```{r}
summary(cats)
# Представлены пол животных, а также количественные оценки веса тел и сердец.
```

3. Рассчитайте среднее (mean), среднеквадратичное отклонение (sd) и дисперсию (var) веса кошачьих сердец.

```{r}
m <- mean(cats$Hwt)
sko <- sd(cats$Hwt)
disp <- var(cats$Hwt)
# Среднее (mean) можно увидить, выполнив summary(cats)
```

4. При помощи полученных значений и формул выше, рассчитайте параметры a и s. Округлите до разумного числа знаков.

```{r}
a <- round(m**2/disp, 3)
s <- round(disp/m, 3)
```

5. Напишите функцию для расчёта параметров a и s через дисперсию и среднее для передаваемого вектора чисел. Функция должна зазываться my.gamma и возвращать рассчитанные параметры в виде именованного вектора.

```{r}
my.gamma <- function(x)
{
  m <- mean(x)
  disp <- var(x)
  a <- round(m**2/disp, 3)
  s <- round(disp/m, 3)
  return(c(a, s))
}
```

6. Какие результаты возвращает функция для вектора весов сердец? Сходятся ли они с ответами в п. 4? Должны сходиться?

```{r}
my.gamma(cats$Hwt)
#Результаты выполнения функции совпадают со значениями рассчитанными ранее, т.к. выполняются одни и те же действия.
```

7. Постройте гистограмму весов. Добавьте на гистограмму кривую плотности вероятности при помощи функций curve и dgamma, указав ранее найденные параметры формы и масштаба.

```{r}
hist(cats$Hwt, xlab = "Вес сердца", ylab = "Вероятность", breaks = 20, probability = T)
curve(dgamma(x, shape = a, scale = s), add = T, col = "red")
```

8. Получите параметры a и s отдельно для котов и кошек, использовав функцию my.gamma.

```{r}
Male <- my.gamma(cats$Hwt[cats$Sex == "M"])
Female <- my.gamma(cats$Hwt[cats$Sex == "F"])
```

9. Постройте полученные функции распределения на одном графике, используя curve и dgamma.

```{r}
hist(cats$Hwt, xlab = "Вес сердца", ylab = "Вероятность", breaks = 20, probability = T)
curve(dgamma(x, shape = Male[1], scale = Male[2]), add = T, col = "red")
curve(dgamma(x, shape = Female[1], scale = Female[2]), add = T, col = "blue")
curve(dgamma(x, shape = a, scale = s), add = T, col = "green")
```

10. Случайным образом разделите данные на две группы одного размера равного количеству котов и кошек соответственно. Получите гамма-параметры для обеих групп. Повторите эксперимент несколько раз. Найдите среднюю разницу между результатами групп.

```{r}
male <- cats[cats$Sex == "M",]
female <- cats[cats$Sex == "F",]
par<-data.frame(a1=0, s1=0, a2=0, s2=0)
for(k in 1:5){
n1 <- sample(dim(male)[1])
n2 <- sample(dim(female)[1])
N1.1 <- male[n1[1:as.integer(length(n1)/2)],]
N1.2 <- male[n1[ceiling(length(n1)/2):(length(n1)-1)],]
N2.1 <- female[n2[1:as.integer(length(n2)/2)],]
N2.2 <- female[n2[ceiling(length(n2)/2):(length(n2)-1)],]
group1 <- rbind(N1.1, N2.1)
group2 <- rbind(N1.2, N2.2)
par1 <- my.gamma(group1$Hwt)
par2 <- my.gamma(group2$Hwt)
p <- data.frame(a1=par1[1], s1=par1[2], a2=par2[1], s2=par2[2])
par <- rbind(par, p)
}

par <- par[-1, ]

# Средняя разница
dif_a <- abs(mean(par[ , c("a1")]-par[ , c("a2")]))
dif_s <- abs(mean(par[ , c("s1")]-par[ , c("s2")]))
```

11. Какие выводы можно сделать относительно полученных распределений для кошек и котов. Есть ли разница? Поясните.

```{r}
# Показатели a и s незначительно отличаются как между группами, так и между любой группой и всей выборкой в целом. Однако показатели a и s для кошек сильно отличаются от показателей всей выборки в целом и показателей котов в частности. 
```

